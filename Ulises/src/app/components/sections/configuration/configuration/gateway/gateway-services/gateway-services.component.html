<form class="form" [formGroup]="form" *ngIf="ready">

    <spinner *ngIf="showSpinner"></spinner>

    <div class="gateway-select" *ngIf="!visualizationMode">
        <mat-form-field class="copy-form-field" appearance="fill">
            <mat-label>{{ 'gateway.copy_from' | translate }}</mat-label>
            <mat-select appearance="fill" (selectionChange)="copyFrom($event.value)">
                <mat-option [value]="serviceItem" *ngFor="let serviceItem of gatewayAvaibleServicesItem">
                    {{ serviceItem.nombre }}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <mat-tab-group class="tabs" selectedIndex="0" (selectedTabChange)="onTabChanged();">
        <mat-tab label="{{ 'gateway.hardware_title_SIP' | translate }}">
            <ng-template matTabContent>
                <div class="sip-form">
                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.port' | translate }}</mat-label>
                        <input matInput formControlName="PuertoLocalSIP">
                    </mat-form-field>
                    <mat-checkbox formControlName="supervisionTlf" [disabled]="false"
                        (change)="resetSupervisionTlf($event.checked)">{{ 'gateway.telf_supervision' | translate}}</mat-checkbox>

                    <mat-form-field appearance="fill" *ngIf="supervisionSelected">
                        <mat-label>{{ 'gateway.supervision_period' | translate }}</mat-label>
                        <input matInput required formControlName="periodo_supervision">
                        <mat-error *ngIf="form.controls['periodo_supervision'].hasError('required')">
                            {{ appset.FIELD_REQUIRED | translate }}
                        </mat-error>
                        <mat-error
                            *ngIf="form.controls['periodo_supervision'].hasError('min') || form.controls['periodo_supervision'].hasError('max')">
                            {{ 'gateway.alert.err.range_90_180' | translate }}
                        </mat-error>
                        <mat-error *ngIf="form.controls['periodo_supervision'].hasError('pattern')">
                            {{ appset.NUMBERS_FORMAT_INVALID | translate }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" *ngIf="supervisionSelected">
                        <mat-label>{{ 'gateway.refresher' | translate }}</mat-label>
                        <mat-select [(value)]="this.form.value.refresher" formControlName="refresher" (selectionChange)="changeRefresher($event)">
                            <mat-option *ngFor="let rfs of refresher" [value]="rfs.value">
                                {{rfs.viewValue | translate}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <div class="proxies">
                        <div class="selectors">

                            <div class="proxy-items">
                                <div class="items" [ngClass]="{'selected': proxy.ip == selectedProxy?.ip}"
                                    *ngFor="let proxy of proxies" (click)="selectProxy(proxy)">
                                    {{ proxy.ip }}
                                </div>
                            </div>

                            <mat-form-field appearance="fill" *ngIf="!visualizationMode">
                                <mat-label>{{ 'gateway.new_proxy' | translate }}</mat-label>
                                <input matInput [formControl]="proxyFormControl">
                                <mat-error *ngIf="proxyFormControl.hasError('required')">
                                    {{ appset.FIELD_REQUIRED | translate }}
                                </mat-error>
                                <mat-error *ngIf="proxyFormControl.hasError('pattern')">
                                    {{ appset.INVALID_IP | translate }}
                                </mat-error>
                            </mat-form-field>

                        </div>

                        <div class="btns" *ngIf="!visualizationMode">
                            <button class="items" mat-raised-button (click)="deleteProxy()">
                                {{ 'button.del_proxy' | translate }}
                            </button>
                            <button class="items" mat-raised-button (click)="addProxy()">
                                {{ 'button.add_proxy' | translate }}
                            </button>
                        </div>
                    </div>

                    <div class="registrars">
                        <div class="selectors">

                            <div class="registrar-items">
                                <div class="items" [ngClass]="{'selected': registrar.ip == selectedRegistrar?.ip}"
                                    *ngFor="let registrar of registrars" (click)="selectRegistrar(registrar)">
                                    {{ registrar.ip }}
                                </div>
                            </div>

                            <mat-form-field appearance="fill" *ngIf="!visualizationMode">
                                <mat-label>{{ 'gateway.new_registrars' | translate }}</mat-label>
                                <input matInput [formControl]="registrarsFormControl">
                                <mat-error *ngIf="registrarsFormControl.hasError('required')">
                                    {{ appset.FIELD_REQUIRED | translate }}
                                </mat-error>
                                <mat-error *ngIf="registrarsFormControl.hasError('pattern')">
                                    {{ appset.INVALID_IP | translate }}
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="btns" *ngIf="!visualizationMode">
                            <button class="items" mat-raised-button (click)="deleteRegistrar()">
                                {{ 'button.del_regis' | translate }}
                            </button>
                            <button class="items" mat-raised-button (click)="addRegistrar()">
                                {{ 'button.add_regis' | translate }}
                            </button>
                        </div>
                    </div>
                </div>
            </ng-template>
        </mat-tab>

        <mat-tab label="{{ 'gateway.hardware_title_Sync' | translate }}">
            <ng-template matTabContent>
                <div class="sinc-form">
                    <div class="sinc">
                        <div class="selectors">

                            <div class="server-items">
                                <div class="items" [ngClass]="{'selected': serverNTP.ip == selectedServer?.ip}"
                                    *ngFor="let serverNTP of servers" (click)="selectNTP(serverNTP)">
                                    {{ serverNTP.ip }}
                                </div>
                            </div>

                            <mat-form-field appearance="fill" *ngIf="!visualizationMode">
                                <mat-label>{{ 'gateway.new_NTP_serv' | translate }}</mat-label>
                                <input matInput [formControl]="serversFormControl">
                                <mat-error *ngIf="serversFormControl.hasError('required')">
                                    {{ appset.FIELD_REQUIRED | translate }}
                                </mat-error>
                                <mat-error *ngIf="serversFormControl.hasError('pattern')">
                                    {{ appset.INVALID_IP | translate }}
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="btns" *ngIf="!visualizationMode">
                            <button class="items" mat-raised-button (click)="deleteNTP()">
                                {{ 'button.del_NTP' | translate }}
                            </button>
                            <button class="items" mat-raised-button (click)="addNTP()">
                                {{ 'button.add_NTP' | translate }}
                            </button>
                        </div>
                    </div>
                    <div class="stlabel">
                            <mat-label class="label">{{ 'maintenance.ntpDefault' | translate }}</mat-label>
                            <mat-label class="content">{{ localConfig.ntpDefault }}</mat-label>
                    </div>
            </div>
            </ng-template>
        </mat-tab>

        <mat-tab label="{{ 'gateway.hardware_title_SNMP' | translate }}">
            <ng-template matTabContent>
                <div class="snpm-form">
                    <div class="snpm">

                        <div class="fields">
                            <div class="col">
                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.service_port' | translate }}</mat-label>
                                    <input matInput formControlName="puerto_servicio_snmp">
                                </mat-form-field>

                                <div class="form-item">
                                    <mat-label>{{ 'gateway.snmp_v2' | translate }}</mat-label>
                                    <mat-checkbox class="checkbox" formControlName="snmpv2" (click)="changeSNMPV2()">
                                    </mat-checkbox>
                                </div>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.snmp_community' | translate }}</mat-label>
                                    <input matInput formControlName="comunidad_snmp">
                                </mat-form-field>
                            </div>
                            <div class="col">
                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.snmp_port' | translate }}</mat-label>
                                    <input matInput formControlName="puerto_snmp">
                                    <mat-error *ngIf="form.controls['puerto_snmp'].hasError('pattern')">
                                        {{ appset.INVALID_RANGE_PORT | translate }}
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.snmp_name' | translate }}</mat-label>
                                    <input matInput formControlName="nombre_snmp">
                                </mat-form-field>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.snmp_location' | translate }}</mat-label>
                                    <input matInput formControlName="localizacion_snmp">
                                </mat-form-field>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.snmp_contact' | translate }}</mat-label>
                                    <input matInput formControlName="contacto_snmp">
                                </mat-form-field>
                            </div>
                        </div>

                        <mat-label>{{ 'gateway.traps_conf' | translate }}</mat-label>
                        <div class="traps traps-group">
                            <div class="col" *ngIf="!visualizationMode">
                                <mat-form-field class="select" appearance="fill">
                                    <mat-label>{{ 'gateway.version' | translate }}</mat-label>
                                    <mat-select [formControl]="trapServerFormControl">
                                        <mat-option [value]="serverNTP" *ngFor="let serverNTP of ['1', '2']">
                                            {{ serverNTP }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="trapServerFormControl.hasError('required')">
                                        {{ appset.FIELD_REQUIRED | translate }}
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.ip_adress' | translate }}</mat-label>
                                    <input matInput [formControl]="trapFormControl">
                                    <mat-error *ngIf="trapFormControl.hasError('required')">
                                        {{ appset.FIELD_REQUIRED | translate }}
                                    </mat-error>
                                    <mat-error *ngIf="trapFormControl.hasError('pattern')">
                                        {{ appset.INVALID_IP | translate }}
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="fill">
                                    <mat-label>{{ 'gateway.port' | translate }}</mat-label>
                                    <input matInput [formControl]="trapPortFormControl">
                                    <mat-error *ngIf="trapPortFormControl.hasError('required')">
                                        {{ appset.FIELD_REQUIRED | translate }}
                                    </mat-error>
                                    <mat-error *ngIf="trapPortFormControl.hasError('pattern')">
                                        {{ appset.INVALID_RANGE_PORT | translate }}
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col traps-list">

                                <div class="trap-items">
                                    <div class="items" [ngClass]="{'selected': trap == selectedTrap}"
                                        *ngFor="let trap of traps" (click)="selectTrap(trap)">
                                        {{ trap }}
                                    </div>
                                </div>

                                <div class="btns" *ngIf="!visualizationMode">
                                    <button class="items" mat-raised-button (click)="deleteTrap()">
                                        {{ 'button.del_trap' | translate }}
                                    </button>
                                    <button class="items" mat-raised-button (click)="addTrap()">
                                        {{ 'button.add_trap' | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </ng-template>
        </mat-tab>

        <mat-tab label="{{ 'gateway.hardware_title_Web' | translate }}">
            <ng-template matTabContent>
                <div class="web-form">
                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.service_port_' | translate }}</mat-label>
                        <input matInput formControlName="puerto_servicio_web">
                        <mat-error *ngIf="form.controls['puerto_servicio_web'].hasError('pattern')">
                            {{ appset.INVALID_RANGE_PORT | translate }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.session_time' | translate }}</mat-label>
                        <input matInput formControlName="tiempo_sesion">
                        <mat-error *ngIf="form.controls['tiempo_sesion'].hasError('pattern')">
                            {{ appset.NUMBERS_FORMAT_INVALID | translate }}
                        </mat-error>
                    </mat-form-field>
                </div>
            </ng-template>
        </mat-tab>

        <mat-tab label="{{ 'gateway.hardware_title_record' | translate }}">
            <ng-template matTabContent>
                <div class="recording-form">
                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.rstp_server_port' | translate }}</mat-label>
                        <input matInput formControlName="puerto_rtsp">
                        <mat-error *ngIf="form.controls['puerto_rtsp'].hasError('pattern')">
                            {{ appset.INVALID_RANGE_PORT | translate }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.rstp_a_ip_server' | translate }}</mat-label>
                        <input matInput formControlName="servidor_rtsp">
                        <mat-error *ngIf="form.controls['servidor_rtsp'].hasError('pattern')">
                            {{ appset.INVALID_IP | translate }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>{{ 'gateway.rstp_b_ip_server' | translate }}</mat-label>
                        <input matInput formControlName="servidor_rtspb">
                        <mat-error *ngIf="form.controls['servidor_rtspb'].hasError('pattern')">
                            {{ appset.INVALID_IP | translate }}
                        </mat-error>
                    </mat-form-field>
                </div>
            </ng-template>
        </mat-tab>
    </mat-tab-group>
</form>