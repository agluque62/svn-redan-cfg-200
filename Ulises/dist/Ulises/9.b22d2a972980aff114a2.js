(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{KonP:function(e,t,i){"use strict";i.r(t),i.d(t,"ResourceComnsComponent",function(){return A});var n=i("mrSG"),c=i("MuhJ"),s=i("fXoL"),o=i("9+1D"),r=i("plSC"),a=i("VITL"),l=i("f5O9"),u=i("kmnG"),d=i("ofXK"),b=i("d3UM"),g=i("3Pt+"),f=i("qFsG"),m=i("bTqV"),h=i("FKr1");function p(e,t){if(1&e){const e=s.Ub();s.Tb(0,"div",14),s.Tb(1,"mat-form-field",15),s.Tb(2,"mat-label"),s.yc(3,"NombreRecurso@IP:Puerto"),s.Sb(),s.Tb(4,"input",16),s.ac("ngModelChange",function(e){return t.$implicit.uri=e})("change",function(i){s.rc(e);const n=t.$implicit;return s.ec(2).checkUri(i,n.nivel_colateral,n.tipo)}),s.Sb(),s.Sb(),s.Tb(5,"button",17),s.ac("click",function(){s.rc(e);const i=t.$implicit,n=s.ec().index;return s.ec().makeURI(n,i.nivel_colateral,i.tipo)}),s.yc(6),s.Sb(),s.Sb()}if(2&e){const e=t.$implicit,i=s.ec(2);s.Cb(4),s.kc("disabled",i.visualizationMode)("ngModel",e.uri),s.Cb(1),s.kc("disabled",i.visualizationMode||void 0!==i.selectedResourceType&&i.selectedResourceType!==i.CONFIGURATION_RESOURCE_TYPE&&void 0!==i.selectedExtResource&&i.selectedExtResource.tipo!==i.RADIO_TX&&i.selectedExtResource.tipo!==i.RADIO_TX_RX),s.Cb(1),s.Ac(" ",i.arrow," ")}}function C(e,t){if(1&e){const e=s.Ub();s.Tb(0,"div",14),s.Tb(1,"mat-form-field",15),s.Tb(2,"mat-label"),s.yc(3,"NombreRecurso@IP:Puerto"),s.Sb(),s.Tb(4,"input",16),s.ac("ngModelChange",function(e){return t.$implicit.uri=e})("change",function(i){s.rc(e);const n=t.$implicit;return s.ec(2).checkUri(i,n.nivel_colateral,n.tipo)}),s.Sb(),s.Sb(),s.Tb(5,"button",17),s.ac("click",function(){s.rc(e);const i=t.$implicit,n=s.ec().index;return s.ec().makeURI(n,i.nivel_colateral,i.tipo)}),s.yc(6),s.Sb(),s.Sb()}if(2&e){const e=t.$implicit,i=s.ec(2);s.Cb(4),s.kc("disabled",i.visualizationMode)("ngModel",e.uri),s.Cb(1),s.kc("disabled",i.visualizationMode||void 0!==i.selectedResourceType&&i.selectedResourceType!==i.CONFIGURATION_RESOURCE_TYPE&&void 0!==i.selectedExtResource&&i.selectedExtResource.tipo!==i.RADIO_RX&&i.selectedExtResource.tipo!==i.RADIO_TX_RX),s.Cb(1),s.Ac(" ",i.arrow," ")}}function v(e,t){if(1&e&&(s.Tb(0,"div",10),s.Tb(1,"mat-label",11),s.yc(2),s.Sb(),s.Tb(3,"mat-label",12),s.yc(4,"TX"),s.Sb(),s.xc(5,p,7,4,"div",13),s.Tb(6,"mat-label",12),s.yc(7,"RX"),s.Sb(),s.xc(8,C,7,4,"div",13),s.Sb()),2&e){const e=t.$implicit;s.Cb(2),s.zc(e.name),s.Cb(3),s.kc("ngForOf",e.fields.tx),s.Cb(3),s.kc("ngForOf",e.fields.rx)}}function O(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",e.value),s.Cb(1),s.Ac(" ",e.viewValue," ")}}function T(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",e.idemplazamiento),s.Cb(1),s.Ac(" ",e.eName," ")}}function R(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",e.idpasarela),s.Cb(1),s.Ac(" ",e.gName," ")}}function M(e,t){if(1&e){const e=s.Ub();s.Tb(0,"mat-form-field",6),s.Tb(1,"mat-label"),s.yc(2,"Seleccione pasarela"),s.Sb(),s.Tb(3,"mat-select",22),s.ac("ngModelChange",function(t){return s.rc(e),s.ec(2).selectedGateway=t})("selectionChange",function(){return s.rc(e),s.ec(2).getResources()}),s.xc(4,R,2,2,"mat-option",8),s.Sb(),s.Sb()}if(2&e){const e=s.ec(2);s.Cb(3),s.kc("ngModel",e.selectedGateway),s.Cb(1),s.kc("ngForOf",e.gateways.data)}}function y(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",t.index),s.Cb(1),s.Ac(" ",e.rName," ")}}function S(e,t){if(1&e){const e=s.Ub();s.Tb(0,"mat-form-field",6),s.Tb(1,"mat-label"),s.yc(2,"Seleccione recurso"),s.Sb(),s.Tb(3,"mat-select",23),s.ac("ngModelChange",function(t){return s.rc(e),s.ec(2).selectedConfResource=t}),s.xc(4,y,2,2,"mat-option",8),s.Sb(),s.Sb()}if(2&e){const e=s.ec(2);s.Cb(3),s.kc("ngModel",e.selectedConfResource),s.Cb(1),s.kc("ngForOf",e.resourcesConf.data)}}function x(e,t){if(1&e){const e=s.Ub();s.Tb(0,"div",19),s.Tb(1,"mat-form-field",6),s.Tb(2,"mat-label"),s.yc(3,"Seleccione emplazamiento"),s.Sb(),s.Tb(4,"mat-select",20),s.ac("ngModelChange",function(t){return s.rc(e),s.ec().selectedSite=t})("selectionChange",function(){return s.rc(e),s.ec().getGateways()}),s.xc(5,T,2,2,"mat-option",8),s.Sb(),s.Sb(),s.xc(6,M,5,2,"mat-form-field",21),s.xc(7,S,5,2,"mat-form-field",21),s.Sb()}if(2&e){const e=s.ec();s.Cb(4),s.kc("ngModel",e.selectedSite),s.Cb(1),s.kc("ngForOf",e.sites.data),s.Cb(1),s.kc("ngIf",e.displayGateways),s.Cb(1),s.kc("ngIf",e.displayResource)}}function _(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",e.value),s.Cb(1),s.Ac(" ",e.viewValue," ")}}function P(e,t){if(1&e){const e=s.Ub();s.Tb(0,"div",26),s.Tb(1,"mat-form-field",15),s.Tb(2,"mat-label"),s.yc(3,"Car\xe1cteres a buscar"),s.Sb(),s.Tb(4,"input",27),s.ac("ngModelChange",function(t){return s.rc(e),s.ec(2).stringToFilter=t}),s.Sb(),s.Sb(),s.Tb(5,"button",28),s.ac("click",function(){return s.rc(e),s.ec(2).checkExtOptSelected()}),s.yc(6," Buscar recursos "),s.Sb(),s.Sb()}if(2&e){const e=s.ec(2);s.Cb(4),s.kc("ngModel",e.stringToFilter)}}function k(e,t){if(1&e&&(s.Tb(0,"mat-option",18),s.yc(1),s.Sb()),2&e){const e=t.$implicit;s.kc("value",e),s.Cb(1),s.Ac(" ",e.alias," ")}}function E(e,t){if(1&e){const e=s.Ub();s.Tb(0,"mat-form-field",6),s.Tb(1,"mat-label"),s.yc(2,"Seleccione recurso"),s.Sb(),s.Tb(3,"mat-select",29),s.ac("ngModelChange",function(t){return s.rc(e),s.ec(2).selectedExtResource=t})("selectionChange",function(){return s.rc(e),s.ec(2).test()}),s.xc(4,k,2,2,"mat-option",8),s.Sb(),s.Sb()}if(2&e){const e=s.ec(2);s.Cb(3),s.kc("ngModel",e.selectedExtResource),s.Cb(1),s.kc("ngForOf",e.extResources.lista_recursos)}}function U(e,t){if(1&e){const e=s.Ub();s.Tb(0,"div",19),s.Tb(1,"mat-form-field",6),s.Tb(2,"mat-label"),s.yc(3,"Seleccione tipo de recurso"),s.Sb(),s.Tb(4,"mat-select",24),s.ac("ngModelChange",function(t){return s.rc(e),s.ec().selectedOptFilter=t})("selectionChange",function(){return s.rc(e),s.ec().checkExtOptSelected()}),s.xc(5,_,2,2,"mat-option",8),s.Sb(),s.Sb(),s.xc(6,P,7,1,"div",25),s.xc(7,E,5,2,"mat-form-field",21),s.Sb()}if(2&e){const e=s.ec();s.Cb(4),s.kc("ngModel",e.selectedOptFilter),s.Cb(1),s.kc("ngForOf",e.optionsFilter),s.Cb(1),s.kc("ngIf",4==e.selectedOptFilter||5==e.selectedOptFilter),s.Cb(1),s.kc("ngIf",e.displayExtResource)}}let A=(()=>{class e{constructor(e,t,i,n){this.resourceService=e,this.dataService=t,this.userService=i,this.alertService=n,this.arrow="<",this.resourceTypes=[{value:0,viewValue:"Recursos configurados"},{value:1,viewValue:"Recursos externos"}],this.optionsFilter=[{value:4,viewValue:"Buscar por Alias"},{value:5,viewValue:"Buscar por URI"},{value:-1,viewValue:"Todos (Radio)"},{value:0,viewValue:"Radio Tx"},{value:1,viewValue:"Radio Tx Rx"},{value:2,viewValue:"Radio Rx"}],this.uriList=[],this.displayConfResourceOpts=!1,this.displayExtResourceOpts=!1,this.displaySearchBar=!1,this.displayGateways=!1,this.displayResource=!1,this.displayExtResource=!1,this.visualizationMode=!1,this.RADIO_TX=0,this.RADIO_TX_RX=1,this.RADIO_RX=2,this.CONFIGURATION_RESOURCE_TYPE=0,this.EXTERNAL_RESOURCE_TYPE=1}ngOnInit(){this.visualizationMode=!!this.visualizationPermission(),this.getSites(),this.checkNumberUriFieldsToDisplay(),this.checkIfUrisExists()}checkNumberUriFieldsToDisplay(){switch(this.resourceForm.value.tipo_agente){case 0:this.uriList=[{name:"EMPLAZAMIENTO 1",fields:{tx:this.initUriArray("TX",1),rx:this.initUriArray("RX",1)}}];break;case 1:this.uriList=[{name:"EMPLAZAMIENTO 1",fields:{tx:this.initUriArray("TX",1,!0),rx:this.initUriArray("RX",1,!0)}}];break;case 2:this.uriList=[{name:"EMPLAZAMIENTO 1",fields:{tx:this.initUriArray("TX",1),rx:this.initUriArray("RX",1)}},{name:"EMPLAZAMIENTO 2",fields:{tx:this.initUriArray("TX",3),rx:this.initUriArray("RX",3)}},{name:"EMPLAZAMIENTO 3",fields:{tx:this.initUriArray("TX",5),rx:this.initUriArray("RX",5)}}];break;case 3:this.uriList=[{name:"EMPLAZAMIENTO 1",fields:{tx:this.initUriArray("TX",1,!0),rx:this.initUriArray("RX",1,!0)}},{name:"EMPLAZAMIENTO 2",fields:{tx:this.initUriArray("TX",3,!0),rx:this.initUriArray("RX",3,!0)}},{name:"EMPLAZAMIENTO 3",fields:{tx:this.initUriArray("TX",5,!0),rx:this.initUriArray("RX",5,!0)}}]}}initUriArray(e,t,i=!1){let n=[{tipo:e+"A",uri:"",nivel_colateral:t}];return i&&n.push({tipo:e+"B",uri:"",nivel_colateral:t+1}),n}visualizationPermission(){return!this.userService.isRole("ADMIN")&&!this.userService.isRole("CONFIGURATION")&&this.userService.isRole("VISUALIZATION")}checkResourceTypeSelected(){this.selectedResourceType===this.CONFIGURATION_RESOURCE_TYPE?(this.displayConfResourceOpts=!0,this.displayExtResourceOpts=!1):(this.displayConfResourceOpts=!1,this.displayExtResourceOpts=!0)}checkExtOptSelected(){return Object(n.a)(this,void 0,void 0,function*(){switch(this.selectedOptFilter){case-1:case 0:case 1:case 2:this.extResources=yield this.resourceService.getCommunicationsExtRadioResources(this.selectedOptFilter).toPromise();break;case 4:case 5:this.extResources=yield this.resourceService.getCommunicationsFilteredRadioResources(this.selectedOptFilter,this.stringToFilter).toPromise()}this.displayExtResource=!0})}checkIfUrisExists(){if(null!=this.resourceForm.value.listaUris&&this.resourceForm.value.listaUris.length>0){let e=["tx","rx"];this.uriList.forEach((t,i)=>{e.forEach(e=>{t.fields[e].forEach((t,n)=>{this.resourceForm.value.listaUris.forEach(c=>{t.nivel_colateral==c.nivel_colateral&&t.tipo==c.tipo&&(this.uriList[i].fields[e][n].uri=c.uri.replace("sip:",""))})})})})}}checkUri(e,t,i){return Object(n.a)(this,void 0,void 0,function*(){if(null==e.target.value.match(c.a.URI_PATTERN)&&""!=e.target.value)yield this.alertService.errorMessage("","URI no v\xe1lido"),e.target.value="";else if(""===e.target.value){const e=this.resourceForm.value.listaUris.find(e=>e.tipo===i&&e.nivel_colateral===t);this.resourceForm.value.listaUris.splice(this.resourceForm.value.listaUris.indexOf(e),1)}else{let n=this.resourceForm.value.listaUris.find(e=>e.tipo===i&&e.nivel_colateral===t);n?this.resourceForm.value.listaUris[this.resourceForm.value.listaUris.indexOf(n)].uri=e.target.value:this.resourceForm.value.listaUris.push({uri:e.target.value,tipo:i,nivel_colateral:t})}})}makeURI(e,t,i){let n="";n=this.displayConfResourceOpts?`${this.resourcesConf.data[this.selectedConfResource].rName}@${this.resourcesConf.data[this.selectedConfResource].gIpv}:${this.resourcesConf.data[this.selectedConfResource].puerto_sip}`:""+this.selectedExtResource.uri;let c="";c=i.includes("TX")?"tx":"rx",this.uriList[e].fields[c][1===t||3===t||5===t?0:1].uri=n,this.resourceForm.value.listaUris.push({uri:n,tipo:i,nivel_colateral:t})}test(){console.log(this.selectedExtResource)}getSites(){return Object(n.a)(this,void 0,void 0,function*(){const e=this.dataService.getDataConfigId();this.sites=yield this.resourceService.getCommunicationsSites(e).toPromise()})}getGateways(){return Object(n.a)(this,void 0,void 0,function*(){this.gateways=yield this.resourceService.getCommunicationsGateways(this.selectedSite).toPromise(),this.displayGateways=!0})}getResources(){return Object(n.a)(this,void 0,void 0,function*(){this.resourcesConf=yield this.resourceService.getCommunicationsResources(this.selectedGateway,void 0).toPromise(),this.displayResource=!0})}}return e.\u0275fac=function(t){return new(t||e)(s.Nb(o.a),s.Nb(r.a),s.Nb(a.a),s.Nb(l.a))},e.\u0275cmp=s.Hb({type:e,selectors:[["resource-comns"]],decls:15,vars:5,consts:[[1,"title"],[1,"comns-tab"],[1,"main-uri"],[1,"uri-fields"],["class","uri-settings",4,"ngFor","ngForOf"],[1,"uri-selects"],["appearance","fill"],["name","resourceTypes",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","opts-row",4,"ngIf"],[1,"uri-settings"],[1,"site"],[1,"uri-title"],["class","uri-row",4,"ngFor","ngForOf"],[1,"uri-row"],["appearance","legacy"],["matInput","",3,"disabled","ngModel","ngModelChange","change"],["mat-raised-button","",3,"disabled","click"],[3,"value"],[1,"opts-row"],["name","sites",3,"ngModel","ngModelChange","selectionChange"],["appearance","fill",4,"ngIf"],["name","gateways",3,"ngModel","ngModelChange","selectionChange"],["name","resourcesConf",3,"ngModel","ngModelChange"],["name","filterResources",3,"ngModel","ngModelChange","selectionChange"],["class","filter",4,"ngIf"],[1,"filter"],["matInput","",3,"ngModel","ngModelChange"],["mat-raised-button","",3,"click"],["name","extResources",3,"ngModel","ngModelChange","selectionChange"]],template:function(e,t){1&e&&(s.Tb(0,"div",0),s.Tb(1,"mat-label"),s.yc(2,"Comunicaciones"),s.Sb(),s.Sb(),s.Tb(3,"div",1),s.Tb(4,"div",2),s.Tb(5,"div",3),s.xc(6,v,9,3,"div",4),s.Sb(),s.Sb(),s.Tb(7,"div",5),s.Tb(8,"mat-form-field",6),s.Tb(9,"mat-label"),s.yc(10,"Seleccione tipo de recurso"),s.Sb(),s.Tb(11,"mat-select",7),s.ac("ngModelChange",function(e){return t.selectedResourceType=e})("selectionChange",function(){return t.checkResourceTypeSelected()}),s.xc(12,O,2,2,"mat-option",8),s.Sb(),s.Sb(),s.xc(13,x,8,4,"div",9),s.xc(14,U,8,4,"div",9),s.Sb(),s.Sb()),2&e&&(s.Cb(6),s.kc("ngForOf",t.uriList),s.Cb(5),s.kc("ngModel",t.selectedResourceType),s.Cb(1),s.kc("ngForOf",t.resourceTypes),s.Cb(1),s.kc("ngIf",t.displayConfResourceOpts),s.Cb(1),s.kc("ngIf",t.displayExtResourceOpts))},directives:[u.f,d.k,u.c,b.a,g.r,g.u,d.l,f.b,g.c,m.a,h.j],styles:[".comns-tab[_ngcontent-%COMP%]{display:inline-flex;width:100%}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]{display:grid;width:inherit}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]{display:grid;grid-column-gap:10px;width:inherit}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]   .uri-settings[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:10px}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]   .uri-settings[_ngcontent-%COMP%]   .site[_ngcontent-%COMP%]{border-bottom:1px solid}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]   .uri-settings[_ngcontent-%COMP%]   .uri-row[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-column-gap:10px}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]   .uri-settings[_ngcontent-%COMP%]   .uri-row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin:auto}.comns-tab[_ngcontent-%COMP%]   .main-uri[_ngcontent-%COMP%]   .uri-fields[_ngcontent-%COMP%]   .uri-settings[_ngcontent-%COMP%]   .uri-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.comns-tab[_ngcontent-%COMP%]   .uri-selects[_ngcontent-%COMP%]{margin-top:40px;width:inherit}.comns-tab[_ngcontent-%COMP%]   .uri-selects[_ngcontent-%COMP%]   .opts-row[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-column-gap:10px}.comns-tab[_ngcontent-%COMP%]   .uri-selects[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]{display:inherit}.comns-tab[_ngcontent-%COMP%]   .uri-selects[_ngcontent-%COMP%]   .filter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:1px}"]}),e})()}}]);